<html><head><title>Add VC Round Record</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
<link rel="stylesheet" type="text/css" href="http://dev.jtsage.com/cdn/datebox/latest/jquery.mobile.datebox.min.css" />
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.2.min.js" type="text/javascript"></script><script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>
<script type="text/javascript" src="http://dev.jtsage.com/cdn/datebox/latest/jquery.mobile.datebox.min.js"></script>
<script type="text/javascript" src="http://dev.jtsage.com/cdn/datebox/i8n/jquery.mobile.datebox.i8n.en.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
     var today = new Date();
     var todayMonth = today.getMonth()+1;
     var thirtyDaysAgo = new Date((new Date()).getTime()-30*60*60*24*1000);
     if ( todayMonth < 10 ) todayMonth = "0"+todayMonth;
     var thirtyDaysAgoMonth = thirtyDaysAgo.getMonth()+1;
     if ( thirtyDaysAgoMonth < 10 ) thirtyDaysAgoMonth = "0"+thirtyDaysAgoMonth;
     var lastFundingDateDefault = today.getFullYear() + '-' + todayMonth + '-01';
     var maxDateDefault = thirtyDaysAgo.getFullYear() + '-' + thirtyDaysAgoMonth + '-01';
     var minDateDefault = (thirtyDaysAgo.getFullYear()-1) + '-' + thirtyDaysAgoMonth + '-01';    

    $("#lastFundingDateInput").attr("value",lastFundingDateDefault);
    $("#maxDateInput").attr("value",maxDateDefault);
    $("#minDateInput").attr("value",minDateDefault);

     var states = new Array( 'AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','PR','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY' );
     for ( var i=0; i<states.length; i++ ) {
       $("#stateSelect").append( $('<option value="'+states[i]+'" id="'+states[i]+'">'+states[i]+'</option>') );
     }
     $("#CA").attr("selected",true);
     $("#stateSelect").attr("selectedIndex",5);
     $("#stateSelect").selectmenu("refresh");
  });
</script>
<script type="text/javascript">
 function showSuccessDialog( _addedRecord ) {
   $.each($("#companyNameDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#cityDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#stateDialog").children(),function(){
      $(this).detach();
   });

   $("#companyNameDialog").append( 'Company Name: '+_addedRecord.companyName );
   $("#cityDialog").append( 'City: '+_addedRecord.city );
   $("#stateDialog").append( 'State: '+_addedRecord.state );
   $("#lastFundingDateDialog").append( 'Last Funding Date: '+_addedRecord.lastFundingDate );
   $("#lastFundingAmountDialog").append( 'Last Funding Amount: '+_addedRecord.lastFundingAmount );
   $("#minDateDialog").append( 'Min Date: '+_addedRecord.minMonth );
   $("#maxDateDialog").append( 'Max Date: '+_addedRecord.maxMonth );
   $("#secondMarketUrlDialog").append( 'SecondMarket URL: '+_addedRecord.secondMarketUrl );
   $("#uniqueVisitorsDialog").append( 'Unique Visitors: '+_addedRecord.uniqueVisitors );
   $("#visitorGrowthDialog").append( 'Visitor Growth: '+_addedRecord.visitorGrowth );
   
   $.mobile.changePage("#successDialog", {transition:"slide"});
 }

 function doSubmit( _getQuery ) {
   //do ajax post of the data here.
   //if the post is successful tell the browser to show the success dialog.
   var getRequest = './addSecondMktFact.jsp?companyName='+_getQuery.companyName+'&city='+_getQuery.city+'&state='+_getQuery.state+'&companyUrl='+encodeURIComponent(_getQuery.companyUrl)+'&lastFundingDate='+_getQuery.lastFundingDate+'&lastFundingAmount='+_getQuery.lastFundingAmount+'&minDate='+_getQuery.minDate+'&maxDate='+_getQuery.maxDate+'&secondMarketUrl='+encodeURIComponent(_getQuery.secondMarketUrl)+'&uniqueVisitors='+_getQuery.uniqueVisitors+'&visitorGrowth='+_getQuery.visitorGrowth;
   $.getJSON( getRequest, function(data){
      if ( data.status == 'success' ) {
        showSuccessDialog( data.records[0] );
      }
   });
 }

 function validateAndPostForm() {
     //check each mandatory field
     //if mandatory fields are missing or blank highlight in red.
     var getQuery = new Object();
     getQuery.companyName = $.trim( $("#companyNameInput").val() );
     getQuery.city = $.trim( $("#cityInput").val() );
     getQuery.state = $.trim( $("#stateSelect").val() );
     getQuery.companyUrl = $.trim( $("#companyUrlInput").val() );
     getQuery.lastFundingDate = $.trim( $("#lastFundingDateInput").val() );
     getQuery.lastFundingAmount = $.trim( $("#lastFundingAmountInput").val() );
     getQuery.minDate = $.trim( $("#minDateInput").val() );
     getQuery.maxDate = $.trim( $("#maxDateInput").val() );
     getQuery.secondMarketUrl = $.trim( $("#secondMarketUrlInput").val() );
     getQuery.uniqueVisitors = $.trim( $("#uniqueVisitorsInput").val() );
     getQuery.visitorGrowth = $.trim( $("#visitorGrowthInput").val() );
     var badField = true;

     if ( getQuery.companyName == "" ) {
       $("#companyNameLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false;
     }
     else {  $("#companyNameLbl").attr("style",""); }
     if ( getQuery.city == "" ) {
       $("#cityLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false;
     } else {  $("#cityLbl").attr("style",""); }
     if ( getQuery.state == "" ) {
       $("#stateLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false;
     } else { $("#stateLbl").attr("style",""); }
     if ( getQuery.companyUrl == "" ) {
       $("#companyUrlLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false;
     } else { $("#companyUrlLbl").attr("style",""); }
     if ( getQuery.lastFundingDate == "" ) {
       $("#lastFundingDateLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false; 
     } else { $("#lastFundingDateLbl").attr("style",""); }
     if ( getQuery.lastFundingAmount == "" ) { 
       $("#lastFundingAmountLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false; 
     } else { $("#lastFundingAmountLbl").attr("style",""); }

     if ( !badField ) {
       alert( "Please correct the input for the fields marked in red." );
     } else {
        doSubmit( getQuery );
     }
  }
</script>
</head><body> 
<div data-role="page" data-theme="b">
 <div data-role="header">
   <h1>Add VC Round Record</h1>
 </div>
 <div data-role="content" data-theme="b">
   <div class="content-primary" id="primaryContent">
   <ul data-role="listview" id="recordListView" data-inset="true">
    <li data-role="fieldcontain" align="left">
      <label for="companyName" style="font-weight:bold;" id="companyNameLbl">Company Name:</label>
      <input type="text" name="companyName" id="companyNameInput"></input>
    </li>
    <li data-role="fieldcontain" align="left">
      <label for="city" style="font-weight:bold;" id="cityLbl">City:</label>
      <input type="text" name="city" id="cityInput"></input>
    </li>
    <li data-role="fieldcontain" align="left">
      <label for="state" style="font-weight:bold;" id="stateLbl">State:</label>
      <select name="state" id="stateSelect"></select>
    </li>
    <li data-role="fieldcontain" align="left">
      <label for="companyUrl" style="font-weight:bold;" id="companyUrlLbl">Company URL:</label>
      <input type="text" name="companyUrl" id="companyUrlInput"></input>
    </li>
    <li data-role="fieldcontain" align="left">
      <label for="lastFundingDate" style="font-weight:bold;" id="lastFundingDateLbl">Last Funding Date:</label>
      <input name="lastFundingDate" id="lastFundingDateInput" type="date" data-role="datebox" data-options='{"mode":"calbox","dateFormat":"%Y-%m-%d"}'></input>
    </li>
    <li data-role="fieldcontain" align="left">
      <label for="lastFundingAmount" style="font-weight:bold;" id="lastFundingAmountLbl">Last Funding Amount:</label>
      <input type="text" name="lastFundingAmount" id="lastFundingAmountInput"></input>
    </li>
   <li data-role="fieldcontain" align="left">
      <label for="minDate" style="font-weight:bold;">Min Date:</label>
      <input name="minDate" id="minDateInput" type="date" data-role="datebox" data-options='{"mode":"calbox","dateFormat":"%Y-%m-%d"}'></input>
    </li>
   <li data-role="fieldcontain" align="left">
      <label for="maxDate" style="font-weight:bold;">Max Date:</label>
      <input name="maxDate" id="maxDateInput" type="date" data-role="datebox" data-options='{"mode":"calbox","dateFormat":"%Y-%m-%d"}'></input>
   </li>
   <li data-role="fieldcontain" align="left">
      <label for="" style="font-weight:bold;">SecondMarket URL:</label>
      <input type="text" name="secondMarketUrl" id="secondMarketUrlInput"></input>
   </li>
   <li data-role="fieldcontain" align="left">
      <label for="uniqueVisitors" style="font-weight:bold;">Unique Visitors:</label>
      <input type="text" name="uniqueVisitors" id="uniqueVisitorsInput"></input>
   </li>
   <li data-role="fieldcontain" align="left">
      <label for="visitorGrowth" style="font-weight:bold;">Visitor Growth:</label>
      <input type="text" name="visitorGrowth" id="visitorGrowthInput"></input>
    </li>
    <li class="ui-body ui-body-b">
      <button type="submit" data-theme="b" onclick="validateAndPostForm();">Add Record</button>
    </li>
  </ul>
  </div>
 </div>
 <div data-role="footer">
   <h2>&copy; 2012 MktNeutral.com</h2>
 </div>
</div>
<div data-role="page" id="successDialog" data-theme="b">
 <div data-role="header">
   <h1>Record Added Successfully</h1>
 </div>
 <div data-role="content" data-theme="b">
   <div class="content-primary" id="primaryContent">
    <ul data-role="listview" id="recordListView" data-inset="true">
      <li><a href="#" id="companyNameDialog"></a></li>
      <li><a href="#" id="cityDialog"></a></li>
      <li><a href="#" id="stateDialog"></a></li>
      <li><a href="#" id="lastFundingDateDialog"></a></li>
      <li><a href="#" id="lastFundingAmountDialog"></a></li>
      <li><a href="#" id="minDateDialog"></a></li>
      <li><a href="#" id="maxDateDialog"></a></li>
      <li><a href="#" id="secondMarketUrlDialog"></a></li>
      <li><a href="#" id="uniqueVisitorsDialog"></a></li>
      <li><a href="#" id="visitorGrowthDialog"></a></li>
    </ul>
    <div align="center"><a href="./addSecondMktFact.html" data-role="button">Add Another Record</a></div>
   </div>
 </div>
 <div data-role="footer">
   <h2>&copy; 2012 MktNeutral.com</h2>
 </div>
</div>
</body></html>